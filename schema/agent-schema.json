{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Codex Agent File Schema",
    "description": "Schema for validating Codex agent frontmatter",
    "type": "object",
    "anyOf": [
        {
            "description": "Nested codex-agent format",
            "required": ["codex-agent"],
            "properties": {
                "codex-agent": {
                    "type": "object",
                    "required": ["name", "role", "scope", "triggers"],
                    "properties": {
                        "name": {
                            "type": "string",
                            "description": "Unique agent identifier (e.g., Agent.AiMentor)",
                            "pattern": "^Agent\\.[A-Za-z0-9_]+$"
                        },
                        "role": {
                            "type": "string",
                            "description": "Description of the agent's role and purpose"
                        },
                        "scope": {
                            "type": "string",
                            "description": "Operational scope of the agent"
                        },
                        "triggers": {
                            "type": "string",
                            "description": "What triggers this agent to run"
                        },
                        "output": {
                            "type": "string",
                            "description": "Where the agent outputs its results"
                        },
                        "environment": {
                            "type": "string",
                            "description": "Environment where agent operates",
                            "enum": [
                                "development",
                                "staging",
                                "production",
                                "CI",
                                "any"
                            ]
                        },
                        "permissions": {
                            "oneOf": [
                                {
                                    "type": "array",
                                    "description": "Legacy DevOnboarder permissions array format",
                                    "items": {
                                        "type": "string",
                                        "pattern": "^[a-z]+:[a-z]+$"
                                    }
                                },
                                {
                                    "type": "object",
                                    "description": "GitHub Actions permissions object format",
                                    "properties": {
                                        "actions": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "attestations": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "checks": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "contents": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "deployments": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "discussions": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "id-token": {
                                            "type": "string",
                                            "enum": ["write", "none"]
                                        },
                                        "issues": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "models": {
                                            "type": "string",
                                            "enum": ["read", "none"]
                                        },
                                        "packages": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "pages": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "pull-requests": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "repository-projects": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "security-events": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        },
                                        "statuses": {
                                            "type": "string",
                                            "enum": ["read", "write", "none"]
                                        }
                                    },
                                    "additionalProperties": false
                                }
                            ]
                        },
                        "critical-requirements-acknowledgment": {
                            "type": "object",
                            "description": "MANDATORY acknowledgment of DevOnboarder ZERO TOLERANCE policies",
                            "required": [
                                "terminal-output-policy",
                                "virtual-environment-policy",
                                "potato-policy",
                                "ci-hygiene-policy"
                            ],
                            "properties": {
                                "terminal-output-policy": {
                                    "type": "string",
                                    "enum": ["confirmed"],
                                    "description": "Acknowledgment of ZERO TOLERANCE terminal output policy (no emojis, Unicode, or hanging patterns)"
                                },
                                "virtual-environment-policy": {
                                    "type": "string",
                                    "enum": ["confirmed"],
                                    "description": "Acknowledgment of MANDATORY virtual environment usage for all Python tooling"
                                },
                                "potato-policy": {
                                    "type": "string",
                                    "enum": ["confirmed"],
                                    "description": "Acknowledgment of Enhanced Potato Policy for sensitive file protection"
                                },
                                "ci-hygiene-policy": {
                                    "type": "string",
                                    "enum": ["confirmed"],
                                    "description": "Acknowledgment of CI hygiene standards and Root Artifact Guard enforcement"
                                },
                                "checklist-completed": {
                                    "type": "boolean",
                                    "description": "Confirmation that docs/agent-onboarding/critical-requirements-checklist.md was completed"
                                },
                                "checklist-date": {
                                    "type": "string",
                                    "format": "date",
                                    "description": "Date when critical requirements checklist was completed (YYYY-MM-DD format)"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "additionalProperties": false
                },
                "permissions": {
                    "oneOf": [
                        {
                            "type": "array",
                            "description": "Legacy DevOnboarder permissions array format",
                            "items": {
                                "type": "string",
                                "pattern": "^[a-z]+:[a-z]+$"
                            }
                        },
                        {
                            "type": "object",
                            "description": "GitHub Actions permissions object format",
                            "properties": {
                                "actions": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "attestations": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "checks": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "contents": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "deployments": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "discussions": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "id-token": {
                                    "type": "string",
                                    "enum": ["write", "none"]
                                },
                                "issues": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "models": {
                                    "type": "string",
                                    "enum": ["read", "none"]
                                },
                                "packages": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "pages": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "pull-requests": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "repository-projects": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "security-events": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "statuses": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                }
                            },
                            "additionalProperties": false
                        }
                    ]
                }
            },
            "additionalProperties": true
        },
        {
            "description": "Flat agent format",
            "required": ["agent", "purpose", "trigger"],
            "properties": {
                "agent": {
                    "type": "string",
                    "description": "Unique agent identifier",
                    "pattern": "^[a-z0-9_-]+$"
                },
                "purpose": {
                    "type": "string",
                    "description": "Clear description of the agent's purpose and functionality"
                },
                "trigger": {
                    "type": "string",
                    "description": "What triggers this agent to activate"
                },
                "environment": {
                    "type": "string",
                    "description": "Environment where agent operates",
                    "enum": [
                        "development",
                        "staging",
                        "production",
                        "CI",
                        "any"
                    ]
                },
                "output": {
                    "type": "string",
                    "description": "Where the agent outputs its results"
                },
                "permissions": {
                    "oneOf": [
                        {
                            "type": "array",
                            "description": "Legacy DevOnboarder permissions array format",
                            "items": {
                                "type": "string"
                            }
                        },
                        {
                            "type": "object",
                            "description": "GitHub Actions permissions object format",
                            "properties": {
                                "actions": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "attestations": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "checks": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "contents": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "deployments": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "discussions": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "id-token": {
                                    "type": "string",
                                    "enum": ["write", "none"]
                                },
                                "issues": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "models": {
                                    "type": "string",
                                    "enum": ["read", "none"]
                                },
                                "packages": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "pages": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "pull-requests": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "repository-projects": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "security-events": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                },
                                "statuses": {
                                    "type": "string",
                                    "enum": ["read", "write", "none"]
                                }
                            },
                            "additionalProperties": false
                        }
                    ]
                },
                "codex_runtime": {
                    "type": "boolean",
                    "description": "Whether the agent runs in the Codex runtime environment"
                },
                "codex_dry_run": {
                    "type": "boolean",
                    "description": "Whether the agent runs in dry-run mode"
                },
                "discord_role_required": {
                    "type": "string",
                    "description": "Required Discord role to use this agent"
                },
                "authentication_required": {
                    "type": "boolean",
                    "description": "Whether authentication is required for this agent"
                },
                "integration_log": {
                    "type": "string",
                    "description": "URL or path to integration logs"
                }
            },
            "additionalProperties": true
        },
        {
            "description": "Documentation format (flexible structure for docs, indices, and guides)",
            "properties": {
                "title": {
                    "type": "string",
                    "description": "Document title"
                },
                "description": {
                    "type": "string",
                    "description": "Document description"
                },
                "document_type": {
                    "type": "string",
                    "description": "Type of document"
                },
                "author": {
                    "type": "string",
                    "description": "Document author"
                },
                "project": {
                    "type": "string",
                    "description": "Project name"
                }
            },
            "additionalProperties": true
        }
    ]
}
