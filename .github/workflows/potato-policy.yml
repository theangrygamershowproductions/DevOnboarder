name: Potato Policy Enforcement

on:
    push:
        paths:
            - "Potato.md"
            - ".gitignore"
            - ".dockerignore"
            - ".codespell-ignore"
    pull_request:
        paths:
            - "Potato.md"
            - ".gitignore"
            - ".dockerignore"
            - ".codespell-ignore"

jobs:
    potato-policy:
        runs-on: ubuntu-latest
        name: Enforce Potato Ignore Policy

        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Check for Potato.md modifications
              run: |
                  if git diff --name-only origin/main..HEAD | grep -q "^Potato\.md$"; then
                    echo "‚ùå POLICY VIOLATION: Potato.md has been modified!"
                    echo "üö´ The Potato Ignore Policy prohibits editing Potato.md"
                    echo "üìã See AGENTS.md for policy details"
                    echo "üìù Required: Project lead approval + CHANGELOG.md documentation"
                    exit 1
                  fi

            - name: Verify ignore file entries
              run: |
                  bash scripts/enhanced_potato_check.sh

            - name: Validate policy compliance
              run: |
                  echo "ü•î Potato Policy Status: COMPLIANT"
                  echo "‚úÖ All Potato protections active"
