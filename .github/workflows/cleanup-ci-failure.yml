on:
    schedule:
        - cron: "0 0 * * *"
jobs:
    cleanup:
        runs-on: ubuntu-latest
        permissions:
            issues: write
        steps:
            - name: Install GitHub CLI
              shell: bash
              run: |
                  set -e
                  if [ "$RUNNER_OS" = "Windows" ]; then
                      choco install gh --no-progress --yes
                  elif [ "$RUNNER_OS" = "macOS" ]; then
                      brew install gh
                  else
                      sudo mkdir -p -m 0755 /etc/apt/keyrings
                      curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg |
                        sudo dd of=/etc/apt/keyrings/githubcli-archive-keyring.gpg
                      sudo chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg
                      echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" |
                        sudo tee /etc/apt/sources.list.d/github-cli.list >/dev/null
                      sudo apt-get update
                      sudo apt-get install -y gh
                  fi
            - name: Ensure latest gh is in PATH
              run: echo "/usr/local/bin" >> "$GITHUB_PATH"
            - name: Show gh version
              run: |
                  which gh
                  gh --version
            - run: |
                  for n in $(gh issue list --label ci-failure --state open --json number --jq '.[].number'); do
                    gh issue close "$n" --reason completed
                  done
              env:
                  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
