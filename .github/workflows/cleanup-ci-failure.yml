on:
  schedule:
    - cron: '0 0 * * *'
jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Install GitHub CLI
        shell: bash
        run: |
          set -e
          if [ "$RUNNER_OS" = "Windows" ]; then
              choco install gh --no-progress --yes
          elif [ "$RUNNER_OS" = "macOS" ]; then
              brew install gh
          else
              sudo apt-get update
              sudo apt-get install -y --no-install-recommends gh
          fi
      - run: |
          for n in $(gh issue list --label ci-failure --state open --json number --jq '.[].number'); do
            gh issue close "$n" --reason completed
          done
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
