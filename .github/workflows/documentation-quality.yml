name: Documentation Quality

on:
    push:
        paths:
            - "**/*.md"
            - ".github/workflows/documentation-quality.yml"
    pull_request:
        paths:
            - "**/*.md"
    workflow_dispatch:

jobs:
    markdown-quality:
        runs-on: ubuntu-latest
        name: Markdown Quality Check

        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
                  fetch-depth: 0

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "18"
                  cache: "npm"
                  cache-dependency-path: "package.json"

            - name: Install markdownlint-cli
              run: npm install -g markdownlint-cli

            - name: Run markdown formatting fixes
              run: |
                  if [ -f "scripts/fix_markdown_simple.sh" ]; then
                    chmod +x scripts/fix_markdown_simple.sh
                    ./scripts/fix_markdown_simple.sh
                  fi

            - name: Check for markdown lint issues
              run: |
                  # Create markdownlint config if it doesn't exist
                  if [ ! -f ".markdownlint.json" ]; then
                    cat > .markdownlint.json << 'EOF'
                  {
                    "MD013": false,
                    "MD033": false,
                    "MD041": false
                  }
                  EOF
                  fi

                  # Run markdownlint with basic rules
                  markdownlint --config .markdownlint.json \
                    --ignore node_modules \
                    --ignore .git \
                    --ignore htmlcov \
                    --ignore venv \
                    --ignore .venv \
                    "**/*.md" || true

            - name: Commit formatting fixes
              if: github.event_name == 'push'
              run: |
                  git config --local user.email "action@github.com"
                  git config --local user.name "GitHub Action"

                  if git diff --quiet; then
                    echo "No formatting changes needed"
                  else
                    git add -A
                    git commit -m "ðŸ”§ Auto-fix markdown formatting [skip ci]" || exit 0
                    git push
                  fi

            - name: Documentation Quality Report
              run: |
                  echo "ðŸ“‹ Documentation Quality Summary"
                  echo "==============================="
                  echo "âœ… Markdown formatting applied"
                  echo "ðŸ“Š Lint check completed"
                  echo "ðŸŽ‰ Documentation quality enforcement active!"
