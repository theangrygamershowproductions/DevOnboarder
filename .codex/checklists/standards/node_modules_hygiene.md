---
title: "Node Modules Hygiene Standard"
date: "2025-07-28"
status: "enforced"
category: "ci-hygiene"
tags: ["node_modules", "gitignore", "ci", "hygiene"]
enforcement: "root_artifact_guard"
---

# üõ°Ô∏è Node Modules Hygiene Standard

## üìã **Standard Requirements**

### **Universal .gitignore Coverage**

All `node_modules/` directories must be ignored by git at **every level**:

```gitignore
# Universal node_modules ignore
node_modules/
**/node_modules/
```

### **Permitted Locations**

`node_modules/` directories are **only allowed** in legitimate application subdirectories:

- ‚úÖ `frontend/node_modules/` - React application dependencies
- ‚úÖ `bot/node_modules/` - Discord bot dependencies
- ‚úÖ `backend/node_modules/` - Backend service dependencies (if applicable)

### **Prohibited Locations**

- ‚ùå `./node_modules/` - Repository root (never allowed)
- ‚ùå `docs/node_modules/` - Documentation directories
- ‚ùå `scripts/node_modules/` - Utility script directories
- ‚ùå Any other non-application directories

## üö´ **Root Artifact Guard Enforcement**

The Root Artifact Guard (`scripts/enforce_output_location.sh`) actively prevents commits when:

```bash
# Detects node_modules in repository root
if find . -maxdepth 1 -name "node_modules" -type d 2>/dev/null | grep -q .; then
    echo "‚ùå VIOLATION: node_modules directory found in repository root"
    echo "   Should only exist in frontend/, bot/, or backend/ directories"
    violations=true
fi
```

## üîß **Cleanup Commands**

### **Remove Root node_modules**

```bash
rm -rf ./node_modules
```

### **Verify Clean State**

```bash
bash scripts/enforce_output_location.sh
```

## üéØ **Benefits**

### **Prevents Bloat and Merge Hell**

- No massive binary files in repository history
- Clean diffs and merge conflicts
- Reduced clone/pull times

### **Maintains Developer Sync**

- All developers use same dependency versions via lock files
- CI environments stay consistent
- No "works on my machine" issues due to version drift

### **Enforces Industry Best Practice**

- Standard approach across JavaScript ecosystem
- Compatible with Docker containerization
- Supports proper caching strategies

## üîÑ **Integration Points**

### **Pre-commit Hooks**

- Root Artifact Guard runs on every commit attempt
- Blocks commits with root `node_modules/` pollution
- Provides clear remediation instructions

### **CI/CD Pipeline**

- GitHub Actions workflows install dependencies in correct locations
- Build processes respect directory structure
- Deployment scripts target appropriate subdirectories

### **Development Workflow**

```bash
# Correct - Install in application directories
cd frontend && npm ci
cd bot && npm ci

# Incorrect - Never install in root
npm ci  # ‚ùå Creates ./node_modules/
```

## üìä **Monitoring and Compliance**

### **Automated Detection**

The Root Artifact Guard provides comprehensive monitoring:

- Real-time violation detection during commits
- Clear violation reporting with specific locations
- Automatic remediation suggestions

### **Compliance Metrics**

- Zero tolerance for root `node_modules/` pollution
- 100% .gitignore coverage for all node_modules patterns
- Automated enforcement prevents human error

## üõ†Ô∏è **Troubleshooting**

### **Common Issues**

#### **Accidental Root Installation**

```bash
# Problem: Ran npm ci in repository root
./node_modules/ created

# Solution: Remove and reinstall in correct location
rm -rf ./node_modules
cd frontend && npm ci
```

#### **IDE/Editor Configuration**

```bash
# Ensure IDE respects .gitignore
# VS Code: Check .vscode/settings.json excludes node_modules
# JetBrains: Check .idea/ excludes node_modules
```

#### **Docker Build Context**

```dockerfile
# Correct - Use specific COPY commands
COPY frontend/package*.json frontend/
COPY bot/package*.json bot/

# Incorrect - Copying root includes pollution
COPY . /app/  # ‚ùå May include ./node_modules/
```

## üìö **Related Standards**

- [Root Artifact Guard System](../agents/tags/ci_root_artifact_guard.md)
- [CI Triage Guard Framework](./2025-07-28_foo_sandbox_pollution.md)
- [DevOnboarder Virtual Environment Standards](../../.github/copilot-instructions.md)

---

**Last Updated**: 2025-07-28
**Enforcement Status**: Active via Root Artifact Guard
**Compliance**: Mandatory for all DevOnboarder repositories
